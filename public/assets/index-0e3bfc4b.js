import{F as D,G as B,Y as y,aN as I,r as c,a0 as k,j as e,f as A,a as h,aL as M,d as t,e as g,S as N,B as R,X as P,aK as Y}from"./index-6bfe4b1d.js";import{D as K}from"./index-8a6db4c7.js";import"./index-336d54fe.js";import{g as W,u as X,a as _}from"./service-5f331a07.js";import{b as z}from"./service-d2087721.js";import H from"./editableTable-8c3bb7ad.js";import{s as J}from"./index.module-6d5fffca.js";import{v as Q,f as E}from"./common-e743d0de.js";import{n as x}from"./index.browser-7e542916.js";import"./index-d564e2b7.js";import"./index-98b813fd.js";const p=D.Item,U=B.Row,f=B.Col;function ne({data:r,onClose:S}){const[o]=D.useForm(),{data:v}=y(z),{data:s,loading:L}=y(()=>r.id&&W(r.id)),{data:n}=y(()=>I("FONT_PRINT")),{data:w}=y(()=>I("CATEGORY")),[V,C]=c.useState(!1),[u,m]=c.useState([]),[O,j]=c.useState([]),[i,b]=c.useState({type:"circle",value:""});c.useEffect(()=>{r.id&&o.setFieldsValue({orderDate:k().format()})},[]),c.useEffect(()=>{s==null||s.forEach(a=>a.nanoid=x()),s&&m(s)},[s]);async function T(){try{await o.validate();const a=o.getFieldsValue();a.charactersId&&(a.charactersTitle=n==null?void 0:n.find(d=>d.id===a.charactersId).title);const l={orderData:a,orderDetailData:u};u.forEach(d=>{d.orderId=r.id,delete d.nanoid}),C(!0),r.id?await X(r.id,l):await _(l),P.success("提交成功 !"),S()}catch{}finally{C(!1)}}const q=()=>{const{type:a,value:l}=i,d=Y.cloneDeep(u);d.forEach(F=>{O.find(G=>G.nanoid===F.nanoid)&&(F[a]=l)}),m(d)};return e(A,{tip:"加载中...",loading:L,children:h(M,{height:"100%",placement:"bottom",title:r.id?"编辑":"新增",visible:!0,onOk:T,autoFocus:!1,focusLock:!1,onCancel:S,confirmLoading:V,children:[e(D,{labelCol:{span:6},wrapperCol:{span:18},form:o,initialValues:r.id&&r||{orderDate:k().toISOString()},validateMessages:Q,children:h(U,{className:"grid-demo",style:{marginBottom:16},children:[e(f,{span:8,children:e(p,{label:"客户名称",field:"customerId",rules:[{required:!0}],children:e(t,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:E,children:v==null?void 0:v.map(a=>e(t.Option,{value:a.id,children:a.name},a.id))})})}),e(f,{span:8,children:e(p,{label:"订单号",field:"orderNumber",children:e(g,{placeholder:"请输入订单号"})})}),h(f,{span:8,children:[e(p,{label:"字印",field:"fontPrint",children:e(t,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:E,onChange:(a,l)=>{o.setFieldValue("fontPrintName","children"in l?l==null?void 0:l.children:"")},children:n==null?void 0:n.map(a=>e(t.Option,{value:a.key,children:a.title},a.id))})}),e(p,{hidden:!0,label:"字印",field:"fontPrintName",children:e(g,{placeholder:"请输入字印",disabled:!0})})]}),e(f,{span:8,children:e(p,{label:"下单日期",field:"orderDate",children:e(K,{onChange:(a,l)=>o.setFieldValue("orderDate",l.toISOString()),placeholder:"请选择下单日期",style:{width:"100%"}})})}),e(f,{span:8,children:e(p,{label:"备注",field:"remark",children:e(g,{placeholder:"请输入备注"})})})]})}),h("div",{className:J["button-group"],children:[e(N,{children:e(R,{type:"primary",onClick:()=>m([...u,{nanoid:x()}]),children:"新增"})}),e(N,{children:h("div",{style:{display:"flex"},children:[h(t,{value:i.type,showSearch:!0,placeholder:"请选择列",style:{marginRight:10,width:100},onChange:a=>b({type:a,value:""}),children:[e(t.Option,{value:"circle",children:"圈号"}),e(t.Option,{value:"singleWeight",children:"件重"}),e(t.Option,{value:"quantity",children:"数量"}),e(t.Option,{value:"category",children:"品名"})]}),i.type==="category"?e(t,{placeholder:"请选择品名",style:{width:160},value:i.value,onChange:a=>b({type:i.type,value:a}),children:w==null?void 0:w.map(a=>e(t.Option,{value:a.key,children:a.title},a.id))}):e(g,{value:i.value,placeholder:"值",style:{width:160},onChange:a=>b({type:i.type,value:a})}),e(R,{type:"primary",onClick:()=>q(),children:"分配"})]})})]}),e(H,{detailData:u,selectedRow:O,setDetailData:m,setSelectedRow:j})]})})}export{ne as default};
