import{F as D,G as B,Y as y,aN as I,r as c,a0 as k,j as e,f as A,a as h,aL as M,d as l,e as g,S as N,B as R,X as P,aK as Y}from"./index-6b1c5c2b.js";import{D as K}from"./index-4c340e51.js";import"./index-094da222.js";import{g as W,u as X,a as _}from"./service-69fa15cc.js";import{b as z}from"./service-243ee648.js";import H from"./editableTable-31e1c7b8.js";import{s as J}from"./index.module-c4e1ad75.js";import{v as Q,f as E}from"./common-e743d0de.js";import{n as x}from"./index.browser-7e542916.js";import"./index-66a212c0.js";import"./index-2d01e45a.js";import"./pictureUpload-b1878e58.js";const p=D.Item,U=B.Row,f=B.Col;function ce({data:r,onClose:S}){const[d]=D.useForm(),{data:v}=y(z),{data:s,loading:L}=y(()=>r.id&&W(r.id)),{data:n}=y(()=>I("FONT_PRINT")),{data:w}=y(()=>I("CATEGORY")),[V,C]=c.useState(!1),[u,m]=c.useState([]),[O,j]=c.useState([]),[i,b]=c.useState({type:"circle",value:""});c.useEffect(()=>{r.id&&d.setFieldsValue({orderDate:k().format()})},[]),c.useEffect(()=>{s==null||s.forEach(a=>a.nanoid=x()),s&&m(s)},[s]);async function T(){try{await d.validate();const a=d.getFieldsValue();a.charactersId&&(a.charactersTitle=n==null?void 0:n.find(o=>o.id===a.charactersId).title);const t={orderData:a,orderDetailData:u};u.forEach(o=>{o.orderId=r.id,delete o.nanoid}),C(!0),r.id?await X(r.id,t):await _(t),P.success("提交成功 !"),S()}catch{}finally{C(!1)}}const q=()=>{const{type:a,value:t}=i,o=Y.cloneDeep(u);o.forEach(F=>{O.find(G=>G.nanoid===F.nanoid)&&(F[a]=t)}),m(o)};return e(A,{tip:"加载中...",loading:L,children:h(M,{height:"100%",placement:"bottom",title:r.id?"编辑":"新增",visible:!0,onOk:T,autoFocus:!1,focusLock:!1,onCancel:S,confirmLoading:V,children:[e(D,{labelCol:{span:6},wrapperCol:{span:18},form:d,initialValues:r.id&&r||{orderDate:k().toISOString()},validateMessages:Q,children:h(U,{className:"grid-demo",style:{marginBottom:16},children:[e(f,{span:8,children:e(p,{label:"客户名称",field:"customerId",rules:[{required:!0}],children:e(l,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:E,children:v==null?void 0:v.map(a=>e(l.Option,{value:a.id,children:a.name},a.id))})})}),e(f,{span:8,children:e(p,{label:"订单号",field:"orderNumber",children:e(g,{placeholder:"请输入订单号"})})}),h(f,{span:8,children:[e(p,{label:"字印",field:"fontPrint",children:e(l,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:E,onChange:(a,t)=>{d.setFieldValue("fontPrintName","children"in t?t==null?void 0:t.children:"")},children:n==null?void 0:n.map(a=>e(l.Option,{value:a.key,children:a.title},a.id))})}),e(p,{hidden:!0,label:"字印",field:"fontPrintName",children:e(g,{placeholder:"请输入字印",disabled:!0})})]}),e(f,{span:8,children:e(p,{label:"下单日期",field:"orderDate",children:e(K,{onChange:(a,t)=>d.setFieldValue("orderDate",t.toISOString()),placeholder:"请选择下单日期",style:{width:"100%"}})})}),e(f,{span:8,children:e(p,{label:"备注",field:"remark",children:e(g,{placeholder:"请输入备注"})})})]})}),h("div",{className:J["button-group"],children:[e(N,{children:e(R,{type:"primary",onClick:()=>m([...u,{nanoid:x()}]),children:"新增"})}),e(N,{children:h("div",{style:{display:"flex"},children:[h(l,{value:i.type,showSearch:!0,placeholder:"请选择列",style:{marginRight:10,width:100},onChange:a=>b({type:a,value:""}),children:[e(l.Option,{value:"circle",children:"圈号"}),e(l.Option,{value:"singleWeight",children:"件重"}),e(l.Option,{value:"quantity",children:"数量"}),e(l.Option,{value:"category",children:"品名"})]}),i.type==="category"?e(l,{placeholder:"请选择品名",style:{width:160},value:i.value,onChange:a=>b({type:i.type,value:a}),children:w==null?void 0:w.map(a=>e(l.Option,{value:a.key,children:a.title},a.id))}):e(g,{value:i.value,placeholder:"值",style:{width:160},onChange:a=>b({type:i.type,value:a})}),e(R,{type:"primary",onClick:()=>q(),children:"分配"})]})})]}),e(H,{detailData:u,selectedRow:O,setDetailData:m,setSelectedRow:j})]})})}export{ce as default};
