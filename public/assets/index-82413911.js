import{F as D,G as E,Y as f,aN as S,r as n,a0 as j,j as e,f as q,a as o,aL as G,d as t,e as g,S as F,B as x,X as A,aK as V}from"./index-6bfe4b1d.js";import{D as H}from"./index-8a6db4c7.js";import"./index-336d54fe.js";import{g as K,u as T,a as P}from"./service-5f331a07.js";import{b as W}from"./service-d2087721.js";import X from"./editableTable-8c3bb7ad.js";import{s as _}from"./index.module-6d5fffca.js";import"./index-d564e2b7.js";import"./index-98b813fd.js";const c=D.Item,$=E.Row,h=E.Col;function le({data:r,onClose:w}){const[p]=D.useForm(),{data:b}=f(W),{data:v,loading:R}=f(()=>K(r.id)),{data:u}=f(()=>S("MARKING")),{data:y}=f(()=>S("CATEGORY")),[Y,C]=n.useState(!1),[d,m]=n.useState([]),[k,B]=n.useState([]),[l,O]=n.useState({type:"circle",number:""});n.useEffect(()=>{r.id&&p.setFieldsValue({orderDate:j().format()})},[]),n.useEffect(()=>{m(v)},[v]);async function L(){try{await p.validate();const a=p.getFieldsValue();a.charactersTitle=u.find(s=>s.id===a.charactersId).title;const i={orderData:a,orderDetailData:d};d.forEach(s=>delete s.orderId),C(!0),r.id?await T(r.id,i):await P(i),A.success("提交成功 !"),w()}catch{}finally{C(!1)}}const M=()=>{const{type:a,number:i}=l,s=V.cloneDeep(d);s.forEach(I=>{k.find(N=>N.id===I.id)&&(I[a]=i)}),m(s)};return e(q,{tip:"加载中...",loading:R,children:o(G,{height:"100%",placement:"bottom",title:r.id?"编辑":"新增",visible:!0,onOk:L,autoFocus:!1,focusLock:!1,onCancel:w,confirmLoading:Y,children:[e(D,{labelCol:{span:6},wrapperCol:{span:18},form:p,initialValues:r.id?r:{enabled:!0,breadcrumb:!0},validateMessages:{required:(a,{label:i})=>`必须填写${i}`,string:{length:"字符数必须是 #{length}",match:"不匹配正则 #{pattern}"},number:{min:"最小值为 #{min}",max:"最大值为 #{max}"}},children:o($,{className:"grid-demo",style:{marginBottom:16},children:[e(h,{span:8,children:e(c,{label:"客户名称",field:"customerId",rules:[{required:!0}],children:e(t,{placeholder:"请选择",allowClear:!0,children:b==null?void 0:b.map(a=>e(t.Option,{value:a.id,children:a.name},a.id))})})}),e(h,{span:8,children:e(c,{label:"订单号",field:"orderNumber",children:e(g,{placeholder:"请输入订单号"})})}),e(h,{span:8,children:e(c,{label:"字印",field:"charactersId",children:e(t,{placeholder:"请选择",allowClear:!0,children:u==null?void 0:u.map(a=>e(t.Option,{value:a.id,children:a.title},a.id))})})}),e(h,{span:8,children:e(c,{label:"下单日期",field:"orderDate",children:e(H,{format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择下单日期",style:{width:"100%"}})})}),e(h,{span:8,children:e(c,{label:"备注",field:"remark",children:e(g,{placeholder:"请输入备注"})})})]})}),o("div",{className:_["button-group"],children:[e(F,{children:e(x,{type:"primary",onClick:()=>m([...d,{}]),children:"新增"})}),e(F,{children:o("div",{style:{display:"flex"},children:[o(t,{value:l.type,showSearch:!0,placeholder:"请选择列",style:{marginRight:10,width:100},onChange:a=>O({type:a,number:l.number}),children:[e(t.Option,{value:"circle",children:"圈号"}),e(t.Option,{value:"singleWeight",children:"件重"}),e(t.Option,{value:"quantity",children:"数量"}),e(t.Option,{value:"categoryId",children:"品名"})]}),l.type==="categoryId"?e(t,{placeholder:"请选择品名",allowClear:!0,value:l.number,children:y==null?void 0:y.map(a=>e(t.Option,{value:a.id,children:a.title},a.id))}):e(g,{value:l.number,placeholder:"值",style:{width:100},onChange:a=>O({type:l.type,number:a})}),e(x,{type:"primary",onClick:()=>M(),children:"分配"})]})})]}),e(X,{detailData:d,setDetailData:m,setSelectedRow:B})]})})}export{le as default};
