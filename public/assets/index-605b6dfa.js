import{r as y,aK as i,j as l,aL as L,a as m,h as p,B as O,X as A}from"./index-c8148c41.js";import"./index-c467507d.js";import{T as n}from"./index-1c8757fc.js";import{n as G}from"./index.browser-7e542916.js";import{l as P}from"./index-93ef027d.js";function X({data:c,onClose:f}){const[b,E]=y.useState([]),S=[{title:"品名",dataIndex:"categoryTitle"},{title:"件重",dataIndex:"singleWeight"},{title:"圈号",dataIndex:"circle"},{title:"合计",dataIndex:"typeCount"}],[$,I]=y.useState([]),[T,k]=y.useState([]);y.useEffect(()=>{const a=i.groupBy(c,"categoryId"),o=i.groupBy(c,e=>`${e.categoryId}-${e.singleWeight}-${e.circle}`),s=Object.keys(o).map(e=>{const r=o[e];let t=0;return r.forEach(u=>t+=u.quantity),{key:G(),...r[0],typeCount:t}});I(s);const d=i.groupBy(c,e=>e.categoryId+"-"+e.customerName);Object.keys(d).forEach(e=>{c.forEach(r=>{const t=e.split("-");if(r.categoryId===t[0]&&r.customerName===t[1]){let u=0;d[e].forEach(j=>u+=j.quantity),r.customerName=`${r.customerName} [${r.categoryTitle}]：${u}`}})}),Object.keys(a).forEach(e=>{c.forEach(r=>{if(r.categoryId===e){let t=0;a[e].forEach(u=>t+=u.quantity),r.categoryTitle=`${r.categoryTitle} [${t}]`}})});const R=i.groupBy(c,"circle"),C=[],x=Object.keys(R).map(e=>(C.push({dataIndex:`circle-${e}`,value:e}),{title:e==="null"?"(空白)":`${e}`,dataIndex:`circle-${e}`,value:e,render:(r,t)=>{if(t.circle===e)return t[`circle-${e}`]=t.quantity,t.quantity;if(!t.circle&&e==="null")return t[`circle-${e}`]=t.quantity,t.quantity;t[`circle-${e}`]=0}}));k(C);const g=i.cloneDeep(x);g.unshift({title:"品名",dataIndex:"categoryTitle"},{title:"客户",dataIndex:"customerName"},{title:"件重",dataIndex:"singleWeight"}),g.push({title:"合计",dataIndex:"totalCount",render:(e,r)=>{let t=0;return x.forEach(u=>{r.circle===u.value&&(t+=Number(r.quantity)),!r.circle&&u.value==="null"&&(t+=Number(r.quantity))}),r.totalCount=t,t}}),E(g)},[]);async function q(){A.success("提交成功 !"),f()}function v(a){return m(n.Summary.Row,{children:[l(n.Summary.Cell,{children:"总计"}),l(n.Summary.Cell,{}),l(n.Summary.Cell,{}),T.map(o=>l(n.Summary.Cell,{children:a.reduce((s,d)=>s+d[o.dataIndex],0)},o.dataIndex)),l(n.Summary.Cell,{children:a.reduce((o,s)=>o+s.totalCount,0)})]})}function B(a){return m(n.Summary.Row,{children:[l(n.Summary.Cell,{children:"总计"}),l(n.Summary.Cell,{}),l(n.Summary.Cell,{}),l(n.Summary.Cell,{children:a.reduce((o,s)=>o+s.typeCount,0)})]})}const h=y.useRef(null),N=P.useReactToPrint({content:()=>h.current});return l(L,{height:"100%",placement:"bottom",title:"开料",visible:!0,onOk:q,autoFocus:!1,focusLock:!1,onCancel:f,children:m(p,{defaultActiveTab:"1",children:[l(p.TabPane,{title:"开料列表",children:(c==null?void 0:c.length)>0&&l(n,{summary:v,rowKey:"id",pagination:!1,columns:b,data:i.sortBy(c,["categoryId","customerName"]),defaultExpandAllRows:!0,border:!0,borderCell:!0})},"1"),m(p.TabPane,{title:"开料统计",children:[l(O,{type:"primary",style:{marginBottom:10},onClick:N,children:"打印"}),l("div",{ref:h,children:l(n,{summary:B,rowKey:"key",pagination:!1,columns:S,data:i.sortBy($,["categoryId","singleWeight"]),defaultExpandAllRows:!0,border:!0,borderCell:!0})})]},"2")]})})}export{X as default};
