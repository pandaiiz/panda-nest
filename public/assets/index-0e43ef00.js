import{b3 as b,R as j,r as d,Y as g,a as l,j as e,B as r,S as p,X as C,b0 as w,t as _,b1 as M,b2 as R,G as O}from"./index-d9b286db.js";import{M as I}from"./index-e84d0038.js";import{C as k}from"./index-1a9b1006.js";import K from"./edit-0818076e.js";import{c as T,T as z}from"./service-47c67cac.js";import{g as E,d as v,u as P}from"./service-7af6ee6e.js";const B=b.Item;function x(){const[n,a]=j(y),[u,o]=d.useState(!1),{data:s,refresh:i}=g(E);function f(t){I.confirm({title:"请确认是否要删除此数据！",onOk:async()=>{await v(t.id),await i(),C.success("删除成功！")}})}const h=async()=>{o(!1),await i()};return l(k,{title:"角色列表",style:{width:"100%"},extra:e(r,{type:"text",onClick:()=>{a({}),o(!0)},children:"新增"}),children:[e(b,{style:{height:"100%"},children:s==null?void 0:s.map(t=>l(B,{onClick:()=>{a(t)},style:{display:"flex",justifyContent:"space-between"},children:[e(p,{children:t.title}),l(p,{children:[e(r,{type:"primary",size:"mini",onClick:()=>{a(t),o(!0)},children:"编辑"}),e(r,{type:"primary",status:"danger",size:"mini",onClick:()=>f(t),children:"删除"})]})]},t.id))}),u&&e(K,{data:n,onClose:h})]})}const Y=Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"}));function S(){const n=w(y),{data:a,loading:u}=g(T),o=a==null?void 0:a.map(t=>t.id),[s,i]=d.useState([]),[f,h]=d.useState([]);return d.useEffect(()=>{var t;i(((t=n==null?void 0:n.menus)==null?void 0:t.map(c=>{if(c.menu.parentId)return c.menuId}))||[])},[n]),e(k,{title:"角色权限",style:{width:"100%"},loading:u,extra:(n==null?void 0:n.id)&&l(p,{children:[e(r,{type:"text",onClick:()=>i(s.length?[]:o),children:s.length?"取消选择":"全选"}),e(r,{type:"text",onClick:async()=>{await P(n==null?void 0:n.id,{menus:[...s,...f].filter(t=>t)}),C.success("保存成功！"),setTimeout(()=>window.location.reload(),500)},children:"保存"})]}),children:n!=null&&n.id?e(_,{children:(a==null?void 0:a.length)>0&&e(z,{checkable:!0,selectable:!1,checkedKeys:s,onCheck:(t,c)=>{h(c.halfCheckedKeys),i(t)},treeData:a,autoExpandParent:!0,fieldNames:{key:"id"}})}):e(M,{description:"请先选择左侧的角色"})})}const $=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"})),{Row:G,Col:m}=O,y=R({key:"selectedRoleState",default:{menus:[]}}),q=()=>e(_,{children:l(G,{gutter:20,children:[e(m,{span:6,children:e(x,{})}),e(m,{span:18,children:e(S,{})})]})}),A=Object.freeze(Object.defineProperty({__proto__:null,default:q,selectedRoleState:y},Symbol.toStringTag,{value:"Module"}));export{A as a,Y as i,$ as m};
