import{q as G,o as J,r as v,ai as fe,b4 as pe,ac as Re,aY as Ae,C as Te,b5 as De,s as ce,a4 as $,aa as Le,a as Ve,j as h,u as Ke,aC as Fe,a2 as me,aQ as Me,aj as Ee,a6 as He,b6 as je,a9 as $e,F as oe,Y as We,X as Ce,e as le,a$ as ie}from"./index-6b1c5c2b.js";import{g as Ue,T as A,a as qe,b as ze,c as Be,u as Ye,d as Ge}from"./service-f0766185.js";import{M as Je}from"./index-5a79b2eb.js";var Z=function(e){var n=e;return G(e)||(n=e==null?[]:[e]),n.map(function(r){return J(r)?r.value:r})},Y=globalThis&&globalThis.__assign||function(){return Y=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Y.apply(this,arguments)},Qe=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,a=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)a.push(i.value)}catch(t){c={error:t}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return a},ee=function(e,n,r){if(e==null)return[];var l=G(e)?e:[e];return l.map(function(i){var a=J(i)?Y({},i):{value:i,label:void 0},c=n[a.value];if(c)a.label=a.label||c.title,a.disabled=c.disabled;else if(G(r)){var t=r.find(function(y){return y.value===a.value});a=Y(Y({},a),t)}return Re(a.label)&&(a.label=a.value),a})},Xe=function(e,n,r,l){if(!l.treeCheckStrictly){var i=Ue(e,n),a=i.checkedKeys,c=i.indeterminateKeys,t=a;return r.current=c,l.treeCheckedStrategy===A.SHOW_PARENT?t=t.filter(function(y){var u=n[y];if(!u||t.indexOf(u.parentKey)===-1)return!0}):l.treeCheckedStrategy===A.SHOW_CHILD&&(t=t.filter(function(y){var u=n[y];if(!u||!u.children||!u.children.length)return!0})),t}return r.current=[],e},Ze=function(e,n,r){var l=v.useRef([]),i=function(){var s=e.value||e.defaultValue||[];if(e.treeCheckable){var b=Xe(Z(s),n,r,e),p=ee(s,n,l.current),V=ee(b,n,p);return V}return ee(s,n)},a=Qe(v.useState(i),2),c=a[0],t=a[1],y=function(s){l.current=s,t(s)};fe(function(){var s=i();"value"in e&&(e.labelInValue?pe(Z(c),Z(s))||y(s):pe(c,s)||y(s))},[e.treeCheckedStrategy,e.treeCheckStrictly,e.treeCheckable,e.value,n]);var u=v.useCallback(function(s,b){var p=e.onChange,V=e.labelInValue,x=e.multiple||e.treeCheckable;"value"in e||y(s);var m;x?m=s.map(function(D){return V?{label:D.label,value:D.value}:D.value}):m=V?s[0]:s[0]&&s[0].value,p&&p(m,b)},[e.onChange,e.labelInValue,e.multiple,e.treeCheckable,e.value]);return[c,u]};const er=Ze;var we={key:"key",title:"title",children:"children",selectable:"selectable",disabled:"disabled",disableCheckbox:"disableCheckbox",checkable:"checkable",isLeaf:"isLeaf"},rr=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,a=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)a.push(i.value)}catch(t){c={error:t}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return a};function ar(e){var n=Ae(e)||{},r=function(){return e.treeData||qe(e.children)},l=rr(v.useState(r()),2),i=l[0],a=l[1];return fe(function(){(e.treeData!==n.treeData||e.children!==n.children)&&a(r())},[e]),[i]}var W=globalThis&&globalThis.__assign||function(){return W=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},W.apply(this,arguments)},tr=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,a=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)a.push(i.value)}catch(t){c={error:t}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return a},ke=globalThis&&globalThis.__spreadArray||function(e,n,r){if(r||arguments.length===2)for(var l=0,i=n.length,a;l<i;l++)(a||!(l in n))&&(a||(a=Array.prototype.slice.call(n,0,l)),a[l]=n[l]);return e.concat(a||Array.prototype.slice.call(n))},_e=function(e,n,r){var l={},i=0,a=function(c,t){var y=c.length;return c.map(function(u,s){var b=u[r.children],p=r.key in u?u[r.key]:((t==null?void 0:t._key)||"")+"-"+s,V=W(W({},u),{title:u[r.title],selectable:u[r.selectable],disabled:u[r.disabled],disableCheckbox:u[r.disableCheckbox],checkable:u[r.checkable],isLeaf:u[r.isLeaf],key:p,children:b,_key:p,parentKey:t?t._key:void 0,pathParentKeys:t&&t.pathParentKeys||[],_level:t._level||0,_index:i++});return y===s+1&&(V.className=ce(n+"-node-is-tail",V.className)),l[p]=V,b&&b.length&&(l[p].children=a(b,{_key:p,_level:V._level+1,pathParentKeys:ke(ke([],tr((t==null?void 0:t.pathParentKeys)||[]),!1),[p],!1)})),V})};return a(e||[],{}),l},nr=function(e,n){var r=v.useContext(Te).getPrefixCls,l=W(W({},we),n),i=De(),a=r("tree"),c=v.useRef(_e(e,a,l));return fe(function(){c.current=_e(e,a,l),i()},[e]),c.current};const lr=nr;var se=globalThis&&globalThis.__assign||function(){return se=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},se.apply(this,arguments)},ir=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,a=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)a.push(i.value)}catch(t){c={error:t}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return a},ur=globalThis&&globalThis.__spreadArray||function(e,n,r){if(r||arguments.length===2)for(var l=0,i=n.length,a;l<i;l++)(a||!(l in n))&&(a||(a=Array.prototype.slice.call(n,0,l)),a[l]=n[l]);return e.concat(a||Array.prototype.slice.call(n))};function cr(e,n){var r=e.value,l=e.multiple,i=e.loadMore,a=e.treeCheckedStrategy,c=e.treeCheckStrictly,t=e.treeData,y=e.treeProps,u=e.prefixCls,s=e.treeCheckable,b=y&&y.renderTitle,p=v.useRef(),V=v.useCallback(function(k,g){var d=g.checkedNodes,I=g.checked,C=g.node,P=k.map(function(O){var R=d.find(function(L){return L&&L.props._key===O});if(!R){var T=r.find(function(L){return L.value===O});return T||{label:O,value:O}}return{label:R.props.title,value:R.props._key,disabled:R.props.disabled}});e.onChange(P,{checked:I,trigger:C==null?void 0:C.props})},[e.onChange,r]),x=v.useCallback(function(k,g){var d=g.node,I=g.selected,C=[{value:d.props._key,label:d.props.title}];if(l){C=ur([],ir(r),!1);var P=C.findIndex(function(O){return O.value===d.props._key});P>-1?C.splice(P,1):C.push({value:d.props._key,label:d.props.title})}e.onChange(C,{trigger:d==null?void 0:d.props,selected:I})},[e.onChange,r,l]),m=v.useCallback(function(k,g){var d=g.node,I=g.e,C=d.props,P=C.checked,O=C.checkable,R=C.disabled,T=C.disableCheckbox;p.current&&!T&&!R&&O!==!1&&p.current.handleCheck&&p.current.handleCheck(!P,d.props._key,I)},[]),D=v.useCallback(function(k){if($(i)){var g=k.props.dataRef;return i(k,g)}return[]},[i]),q=v.useCallback(function(k){if(b)return b(k);var g=e.inputValue,d=k.title;if(g&&Le(d)){var I=d.toLowerCase().indexOf(g.toLowerCase());if(I===-1)return d;var C=d.substr(0,I),P=d.substr(I+g.length);return Ve("span",{children:[C,h("span",{className:u+"-highlight",children:d.substr(I,g.length)}),P]})}return d},[u,e.inputValue,b]),re=v.useMemo(function(){return e.treeCheckable?{onCheck:V,checkedKeys:r.map(function(k){return k.value})}:{}},[V,r,e.treeCheckable]),Q=v.useMemo(function(){return e.treeCheckable?[]:r.map(function(k){return k.value})},[e.treeCheckable,r]),N=v.useCallback(function(k,g){e.treeCheckable?m(k,g):x(k,g)},[e.treeCheckable,m,x]);return v.useImperativeHandle(n,function(){return p.current},[]),h(A,{...se({ref:p,size:e.size,blockNode:!0,filterNode:e.filterNode},y,{checkable:s,multiple:l,loadMore:e.loadMore?D:void 0,checkedStrategy:a,checkStrictly:c,onMouseDown:function(k){k.preventDefault()}},re,{treeData:t,fieldNames:e.fieldNames,renderTitle:q,onSelect:N,selectedKeys:Q})})}const or=v.forwardRef(cr);var E=globalThis&&globalThis.__assign||function(){return E=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},E.apply(this,arguments)},sr=globalThis&&globalThis.__awaiter||function(e,n,r,l){function i(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function t(s){try{u(l.next(s))}catch(b){c(b)}}function y(s){try{u(l.throw(s))}catch(b){c(b)}}function u(s){s.done?a(s.value):i(s.value).then(t,y)}u((l=l.apply(e,n||[])).next())})},fr=globalThis&&globalThis.__generator||function(e,n){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},l,i,a,c;return c={next:t(0),throw:t(1),return:t(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function t(u){return function(s){return y([u,s])}}function y(u){if(l)throw new TypeError("Generator is already executing.");for(;r;)try{if(l=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=n.call(e,r)}catch(s){u=[6,s],i=0}finally{l=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},j=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,a=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)a.push(i.value)}catch(t){c={error:t}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return a},Se=globalThis&&globalThis.__spreadArray||function(e,n,r){if(r||arguments.length===2)for(var l=0,i=n.length,a;l<i;l++)(a||!(l in n))&&(a||(a=Array.prototype.slice.call(n,0,l)),a[l]=n[l]);return e.concat(a||Array.prototype.slice.call(n))};function ue(e){return!e||G(e)&&e.length===0||J(e)&&Object.keys(e).length===0}var dr={bordered:!0,treeCheckedStrategy:A.SHOW_CHILD,fieldNames:we},vr=function(e,n){var r=v.useContext(Te),l=r.getPrefixCls,i=r.renderEmpty,a=r.componentConfig,c=r.rtl,t=Ke(e,dr,a==null?void 0:a.TreeSelect),y=Fe(),u=v.useRef(),s=v.useRef(null),b=v.useRef(null),p=v.useRef([]),V=j(ar(t),1),x=V[0],m=lr(x,t.fieldNames),D=j(v.useState(),2),q=D[0],re=D[1],Q=j(me(!1,{value:t.popupVisible}),2),N=Q[0],k=Q[1],g=j(me(void 0,{value:"inputValue"in t?t.inputValue||"":void 0}),2),d=g[0],I=g[1],C=v.useRef(d),P=v.useRef(null),O=t.onInputValueChange,R=j(er(t,m,p),2),T=R[0],L=R[1],z=t.multiple||t.treeCheckable,H=l("tree-select"),ae=d&&!$(t.onSearch),de=Me(H+"-popup-"),ve=function(o){var f;o!==N&&(k(o),(f=t.onVisibleChange)===null||f===void 0||f.call(t,o))},te=function(o,f){(o!==C.current||f!==P.current)&&(I(o),C.current=o,P.current=f,O&&O(o,f))},Ie=v.useCallback(function(o){var f=Ee(function(S){return sr(void 0,void 0,void 0,function(){var _;return fr(this,function(w){switch(w.label){case 0:return $(t.onSearch)?[4,t.onSearch(S)]:[3,2];case 1:return w.sent(),[2];case 2:return S?(_=new Set,Object.keys(m).forEach(function(F){var K=m[F],B=!1;if($(t.filterTreeNode))t.filterTreeNode(S,h(A.Node,{...E({},K)}))&&(B=!0);else{var ye=K.value||K._key;ye&&ye.indexOf(S)>-1&&(B=!0)}B&&_.add(K.key)}),re(_),[2]):[2,x]}})})},100);return f(o)},[t.onSearch,x,m,t.filterTreeNode]),he=v.useCallback(function(){var o=!0;J(t.showSearch)&&(o=t.showSearch.retainInputValueWhileSelect!==!1),t.multiple&&!o&&d!==void 0&&te("","optionChecked")},[d,t.multiple,JSON.stringify(t.showSearch)]),X=v.useCallback(function(o,f){L(o,f),he(),z||ve(!1)},[L,he,N]),Pe=function(o,f,S){if(S.stopPropagation(),!o.disabled){var _=J(o.value)?o.value.value:o.value;if(!t.treeCheckable||t.treeCheckStrictly||!m[_]){var w=T.filter(function(K,B){return B!==f});X(w,{trigger:m[_]||o,checked:!1,selected:!1});return}var F=ze(_,!1,Z(T),m,p.current);p.current=F.indeterminateKeys,X(ee(F.checkedKeys,m,T),{trigger:m[_],checked:!1,selected:!1})}};v.useEffect(function(){d!==void 0&&Ie(d),d!==C.current&&(C.current=d)},[d]);var ne=v.useMemo(function(){var o=[];if(d)for(var f in m){var S=m[f],_=Se(Se([],j(S.pathParentKeys),!1),[f],!1);_.some(function(w){return q&&q.has(w)})&&(o=o.concat(_))}return Array.from(new Set(o))},[d,m,q]);v.useEffect(function(){N?setTimeout(function(){var o=T[0];s.current&&o&&s.current.scrollIntoView(o.value)}):y||d&&te("","optionListHide")},[N]),v.useImperativeHandle(n,function(){return{focus:function(){b.current&&b.current.focus()},blur:function(){b.current&&b.current.blur()}}});var Oe=v.useCallback(function(o){return ae?ne.indexOf(o._key)>-1:!0},[ae,ne]),xe=v.useCallback(function(o){var f=o||{},S=f.disabled,_=f.value,w=o==null?void 0:o.label;return $(t.renderFormat)&&(w=t.renderFormat(m[_]||null,t.labelInValue?o:_)),{text:w||_||"",disabled:S}},[t.renderFormat,t.labelInValue,m]),Ne=function(o){L(o,{})},be=function(o){return h($e,{...E({autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,ref:u,classNames:"slideDynamicOrigin",trigger:"click",position:"bl",getPopupContainer:t.getPopupContainer,popupAlign:{bottom:4},unmountOnExit:t.unmountOnExit},t.triggerProps,{className:ce(H+"-trigger",t.triggerProps&&t.triggerProps.className),popup:function(){var f,S,_,w,F=t.dropdownRender,K=ae&&ue(ne)||ue(x)?t.notFoundContent||i("TreeSelect"):h(or,{...E({prefixCls:H,ref:s},t,{inputValue:d,filterNode:Oe,value:T,onChange:X,multiple:z,treeData:x})});return h("div",{id:de,className:ce(H+"-popup",(f={},f[H+"-rtl-popup"]=c,f)),style:E({maxHeight:!((S=t.treeProps)===null||S===void 0)&&S.height||!((w=(_=t.treeProps)===null||_===void 0?void 0:_.virtualListProps)===null||w===void 0)&&w.height?"unset":""},t.dropdownMenuStyle),children:$(F)?F(K):K})},disabled:t.disabled,onVisibleChange:function(f){ve(f)},popupVisible:N}),children:o})},ge=typeof t.triggerElement=="function"?function(){var o,f;return z?f=T.map(function(S){return t.labelInValue?{label:S.label,value:S.value}:S.value}):f=t.labelInValue?T[0]:(o=T[0])===null||o===void 0?void 0:o.value,t.triggerElement({value:f})}():t.triggerElement;return He(ge)?h(je,{...E({ref:b,rtl:c,ariaControls:de},t,{popupVisible:N,value:!z&&G(T)?T[0]:T,inputValue:d,isEmptyValue:ue(T),prefixCls:H,isMultiple:z,renderText:xe,onSort:Ne,onRemoveCheckedItem:Pe,onClear:function(o){var f;o.stopPropagation(),X([],{}),(f=t.onClear)===null||f===void 0||f.call(t,!!N)},onKeyDown:function(o){var f;o.stopPropagation(),(f=t.onKeyDown)===null||f===void 0||f.call(t,o)},onFocus:function(o){o&&o.stopPropagation()},onChangeInputValue:function(o){te(o,"manual")},renderView:be})}):be(ge)},hr=v.forwardRef(vr),U=hr;U.displayName="TreeSelect";U.Node=A.Node;U.SHOW_ALL=A.SHOW_ALL;U.SHOW_PARENT=A.SHOW_PARENT;U.SHOW_CHILD=A.SHOW_CHILD;const br=U;const M=oe.Item;function mr({data:e,onClose:n}){const[r]=oe.useForm(),{data:l,loading:i}=We(Be);async function a(){await r.validate();const c=r.getFieldsValue();e.id?await Ye(e.id,c):await Ge(c),Ce.success("提交成功 !"),n()}return h("div",{children:h(Je,{title:e.id?"编辑":"新增",visible:!0,onOk:a,autoFocus:!1,focusLock:!1,onCancel:n,confirmLoading:i,children:Ve(oe,{labelCol:{span:5},wrapperCol:{span:18},form:r,initialValues:e.id?e:{enabled:!0,breadcrumb:!0},validateMessages:{required:(c,{label:t})=>`必须填写${t}`,string:{length:"字符数必须是 #{length}",match:"不匹配正则 #{pattern}"},number:{min:"最小值为 #{min}",max:"最大值为 #{max}"}},children:[h(M,{label:"上级节点",field:"parentId",children:h(br,{placeholder:"请选择上级节点",treeData:l,allowClear:!0,fieldNames:{key:"id"},onChange:c=>{c===e.id&&(Ce.error("不能选择自己作为上级节点！"),r.setFieldsValue({parentId:e.parentId}))}})}),h(M,{label:"名称",field:"title",rules:[{required:!0}],children:h(le,{placeholder:"请输入菜单名称"})}),h(M,{label:"地址",field:"key",rules:[{required:!0}],children:h(le,{placeholder:"请输入菜单地址"})}),h(M,{label:"备注",field:"remark",children:h(le,{placeholder:"请输入备注"})}),h(M,{label:"启用",field:"enabled",triggerPropName:"checked",disabled:!e.parentId,children:h(ie,{})}),h(M,{tooltip:"当前页是否展示面包屑。",label:"面包屑",field:"breadcrumb",triggerPropName:"checked",children:h(ie,{})}),h(M,{tooltip:"当前路由是否渲染菜单项，为 true 的话不会在菜单中显示，但可通过路由地址访问。",label:"不渲染",field:"ignore",triggerPropName:"checked",children:h(ie,{})})]})})})}export{mr as default};
