import{F as v,G as x,Y as g,aN as I,r as c,a0 as F,j as e,f as A,a as h,aL as M,d as l,e as y,S as N,B as R,X as P,aK as Y}from"./index-f1de8f67.js";import{D as K}from"./index-1f43dd28.js";import"./index-14e4c17a.js";import{g as W,u as X,a as _}from"./service-ea9f51a1.js";import{b as z}from"./service-38147011.js";import H from"./editableTable-9affac03.js";import{s as J}from"./index.module-6d5fffca.js";import{v as Q,f as k}from"./common-e743d0de.js";import{n as E}from"./index.browser-7e542916.js";import"./index-0a89d5bb.js";import"./index-27455959.js";const u=v.Item,U=x.Row,m=x.Col;function oe({data:t,onClose:D}){const[n]=v.useForm(),{data:b}=g(z),{data:s,loading:B}=g(()=>t.id&&W(t.id)),{data:o}=g(()=>I("FONT_PRINT")),{data:w}=g(()=>I("CATEGORY")),[L,S]=c.useState(!1),[p,f]=c.useState([]),[V,j]=c.useState([]),[i,C]=c.useState({type:"circle",number:""});c.useEffect(()=>{t.id&&n.setFieldsValue({orderDate:F().format()})},[]),c.useEffect(()=>{s==null||s.forEach(a=>a.nanoid=E()),s&&f(s)},[s]);async function T(){try{await n.validate();const a=n.getFieldsValue();a.charactersId&&(a.charactersTitle=o==null?void 0:o.find(d=>d.id===a.charactersId).title);const r={orderData:a,orderDetailData:p};p.forEach(d=>{d.orderId=t.id,delete d.nanoid}),S(!0),t.id?await X(t.id,r):await _(r),P.success("提交成功 !"),D()}catch{}finally{S(!1)}}const q=()=>{const{type:a,number:r}=i,d=Y.cloneDeep(p);d.forEach(O=>{V.find(G=>G.id===O.id)&&(O[a]=r)}),f(d)};return e(A,{tip:"加载中...",loading:B,children:h(M,{height:"100%",placement:"bottom",title:t.id?"编辑":"新增",visible:!0,onOk:T,autoFocus:!1,focusLock:!1,onCancel:D,confirmLoading:L,children:[e(v,{labelCol:{span:6},wrapperCol:{span:18},form:n,initialValues:t.id&&t||{orderDate:F().toISOString()},validateMessages:Q,children:h(U,{className:"grid-demo",style:{marginBottom:16},children:[e(m,{span:8,children:e(u,{label:"客户名称",field:"customerId",rules:[{required:!0}],children:e(l,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:k,children:b==null?void 0:b.map(a=>e(l.Option,{value:a.id,children:a.name},a.id))})})}),e(m,{span:8,children:e(u,{label:"订单号",field:"orderNumber",children:e(y,{placeholder:"请输入订单号"})})}),h(m,{span:8,children:[e(u,{label:"字印",field:"fontPrint",children:e(l,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:k,onChange:(a,r)=>{n.setFieldValue("fontPrintName","children"in r?r==null?void 0:r.children:"")},children:o==null?void 0:o.map(a=>e(l.Option,{value:a.key,children:a.title},a.id))})}),e(u,{hidden:!0,label:"字印",field:"fontPrintName",children:e(y,{placeholder:"请输入字印",disabled:!0})})]}),e(m,{span:8,children:e(u,{label:"下单日期",field:"orderDate",children:e(K,{onChange:(a,r)=>n.setFieldValue("orderDate",r.toISOString()),placeholder:"请选择下单日期",style:{width:"100%"}})})}),e(m,{span:8,children:e(u,{label:"备注",field:"remark",children:e(y,{placeholder:"请输入备注"})})})]})}),h("div",{className:J["button-group"],children:[e(N,{children:e(R,{type:"primary",onClick:()=>f([...p,{nanoid:E()}]),children:"新增"})}),e(N,{children:h("div",{style:{display:"flex"},children:[h(l,{value:i.type,showSearch:!0,placeholder:"请选择列",style:{marginRight:10,width:100},onChange:a=>C({type:a,number:i.number}),children:[e(l.Option,{value:"circle",children:"圈号"}),e(l.Option,{value:"singleWeight",children:"件重"}),e(l.Option,{value:"quantity",children:"数量"}),e(l.Option,{value:"categoryId",children:"品名"})]}),i.type==="categoryId"?e(l,{placeholder:"请选择品名",allowClear:!0,value:i.number,children:w==null?void 0:w.map(a=>e(l.Option,{value:a.id,children:a.title},a.id))}):e(y,{value:i.number,placeholder:"值",style:{width:100},onChange:a=>C({type:i.type,number:a})}),e(R,{type:"primary",onClick:()=>q(),children:"分配"})]})})]}),e(H,{detailData:p,setDetailData:f,setSelectedRow:j})]})})}export{oe as default};
